{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/how-to-write-a-dockerfile-considering-best-practicecs","result":{"data":{"markdownRemark":{"excerpt":"Introduction In this article we will go through a list of best practices to write a Dockerfile to containerize your projects regardless toâ€¦","html":"<h2 id=\"Introduction\" style=\"position:relative;\"><a href=\"#Introduction\" aria-label=\"Introduction permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>In this article we will go through a list of best practices to write a Dockerfile to containerize your projects regardless to the technology and programming language used.</p>\n<p>Firstly lets see why we need to containerize our projects and why we should use docker or in one word why we do need Dockerization (Containerization + Docker).</p>\n<p>As for Portability we can deploy our containerized application to any other systems where we can find a container engine system installed without being worry about the dependencies and required tools the application depends on. When we prefer containers to virtual machines actually we loook to have a quicker to start, faster to create, and a system with much smaller footprints. These properties of a container system means that it bring a higher performance. We can also be confident about the Agility and responsiveness of your software development process while using containers. When we talk about Isolation again containerization takes our attention as it Isolates what ever required to run the application as a block box. It is also scalable as it is possible to create an unlimitted number of instantiations without any conflict with each other. Overall these properties of a containerized application helps us to make a container orchestration system dream come true in the future.</p>\n<p>Docker as an open platform for developing, shipping, and running applications has almost all the features we expect from a container engine. It is an OS-level virtualization and it has a much smaller footprints compared virtual machines which are a copy of the whole OS kernel. It means docker would use the same kernel on your machine and just makes the application layer for us.</p>\n<p>To deploy our applications as a docker container we need to write a Dockerfile for the project containing all the configuration to fetch, build and run all the dependencies of our project.</p>\n<p>Below you can see a Dockerfile example which is the most simple one.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ubuntu:18.04</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . /app</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> make /app</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> python /app/app.py</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>First line fetches the operating system required for our environment. COPY copies the source code of our project in to the docker image we want to build. Following that we use RUN to execute a command and in this example it makes the application. CMD runs a command line code, it can be used to execute the service from an entrypoint.</p>\n<p>When we run an Image and generate a container based on, we actually add a new layer (Container layer) on top of the undelying layers.All changes made to the running container, such as writing new files, modifying existing files, and deleting files, are written to this writable container layer.</p>\n<h2 id=\"Dockerfile-best-practices\" style=\"position:relative;\"><a href=\"#Dockerfile-best-practices\" aria-label=\"Dockerfile best practices permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile best practices</h2>\n<p>Most probably you have different environment in your software development jurney.(Development, Staging, Pre-production, Production,... etc). By taking it to the consideration we don't to copy all the files in our project to a docker container while we just want to run it on a specific environment.</p>\n<p>Use Multi-stage build in your Dockerfile to just copy the necessasry artifacts to an environment. For example if you are shipping to a production environment lots of build-time dependencies and files are redundant and not needed for running your application. With this multi-stage build these resources can be used just when the runtime environment contains only what's required and necessary. In another word multi-stage builds ar a promissing way to get rid of what is called overweight and security threats.</p>\n<p>Example Of a Dockerfile for multi-stage builds</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:12.19.0-alpine3.9 <span class=\"token keyword\">AS</span> development</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> NODE_ENV=deevelopment</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NODE_ENV=<span class=\"token variable\">${NODE_ENV}</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> NODE_PORT=8085</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NODE_PORT=<span class=\"token variable\">${NODE_PORT}</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /usr/src/app</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> package*.json ./</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install glob rimraf</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm run build</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:12.19.0-alpine3.9 <span class=\"token keyword\">as</span> production</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> NODE_ENV=production</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NODE_ENV=<span class=\"token variable\">${NODE_ENV}</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> NODE_PORT=8085</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> NODE_PORT=<span class=\"token variable\">${NODE_PORT}</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /usr/src/app</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> package*.json ./</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> <span class=\"token options\"><span class=\"token property\">--from</span><span class=\"token punctuation\">=</span><span class=\"token string\">development</span></span> /usr/src/app/dist ./dist</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [<span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"dist/main\"</span>]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"Dont-write-the-container-as-root-user\" style=\"position:relative;\"><a href=\"#Dont-write-the-container-as-root-user\" aria-label=\"Dont write the container as root user permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dont write the container as root user</h2>\n<p>It is a common mistake to run a docker container as rooot user unless wou are in a very force situation that is even very rare to happen. Thus it is better to include the user instruction to change the defaault UID to a non-root user.</p>\n<p>Additionnally the execution environment may block ccontainers as a root user. To run a docker container as a non-root user we need to go through a ccouple of steps inside the Dockerfile. At first we need to make sure that th user specified in the 'User' instruction exists inside the container and then we need to provide the file system permission at the place where the process will be reading or writting from/to the file.</p>\n<p>Example</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> adduser -D {user_name} &amp;&amp; shown -R {user_name} /{data_directory}</span>\n<span class=\"token comment\"># COPY application files here</span>\n<span class=\"token instruction\"><span class=\"token keyword\">USER</span> {user_name}</span>\nENTYPOINT [\"/app\"]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>At first container will start as root user and then it will change to the standard user that we recently created.</p>\n<p>full docker file example</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:fermium-alpine <span class=\"token keyword\">AS</span> environment</span>\n\n\n<span class=\"token instruction\"><span class=\"token keyword\">ARG</span> MS_HOME=/app</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> MS_HOME=<span class=\"token string\">\"${MS_HOME}\"</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> MS_SCRIPTS=<span class=\"token string\">\"${MS_HOME}/scripts\"</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> USER_NAME=node USER_UID=1000 GROUP_NAME=node GROUP_UID=1000</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> <span class=\"token string\">\"${MS_HOME}\"</span></span>\n\n<span class=\"token comment\"># Build</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> environment <span class=\"token keyword\">AS</span> develop</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> [<span class=\"token string\">\"./package.json\"</span>, <span class=\"token string\">\"./package-lock.json\"</span>, <span class=\"token string\">\"${MS_HOME}/\"</span>]</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> develop <span class=\"token keyword\">AS</span> builder</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . <span class=\"token string\">\"${MS_HOME}\"</span></span>\n\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> PATH=<span class=\"token string\">\"$(npm bin)\"</span>:<span class=\"token variable\">${PATH}</span> <span class=\"token operator\">\\</span>\n  &amp;&amp; npm ci <span class=\"token operator\">\\</span>\n  &amp;&amp; npm run test:ci <span class=\"token operator\">\\</span>\n  &amp;&amp; npm run test:e2e <span class=\"token operator\">\\</span>\n  &amp;&amp; npm run-script build <span class=\"token operator\">\\</span>\n  <span class=\"token comment\"># Clean up dependencies for production image</span>\n  &amp;&amp; npm install --frozen-lockfile  --production &amp;&amp; npm cache clean --force</span>\n\n<span class=\"token comment\"># Serve</span>\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> environment <span class=\"token keyword\">AS</span> prod</span>\n\n\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> [<span class=\"token string\">\"./scripts/docker-entrypoint.sh\"</span>, <span class=\"token string\">\"/usr/local/bin/entrypoint\"</span>]</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> [<span class=\"token string\">\"./scripts/bootstrap.sh\"</span>, <span class=\"token string\">\"/usr/local/bin/bootstrap\"</span>]</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> <span class=\"token options\"><span class=\"token property\">--from</span><span class=\"token punctuation\">=</span><span class=\"token string\">builder</span></span> <span class=\"token string\">\"${MS_HOME}/node_modules\"</span> <span class=\"token string\">\"${MS_HOME}/node_modules\"</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> <span class=\"token options\"><span class=\"token property\">--from</span><span class=\"token punctuation\">=</span><span class=\"token string\">builder</span></span> <span class=\"token string\">\"${MS_HOME}/dist\"</span> <span class=\"token string\">\"${MS_HOME}/dist\"</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span>  <span class=\"token operator\">\\</span>\n  apk --update add --no-cache tini bash <span class=\"token operator\">\\</span>\n  &amp;&amp; deluser --remove-home node <span class=\"token operator\">\\</span>\n  &amp;&amp; addgroup -g <span class=\"token variable\">${GROUP_UID}</span> -S <span class=\"token variable\">${GROUP_NAME}</span> <span class=\"token operator\">\\</span>\n  &amp;&amp; adduser -D -S -s /sbin/nologin -u <span class=\"token variable\">${USER_UID}</span> -G <span class=\"token variable\">${GROUP_NAME}</span> <span class=\"token string\">\"${USER_NAME}\"</span> <span class=\"token operator\">\\</span>\n  &amp;&amp; chown -R <span class=\"token string\">\"${USER_NAME}:${GROUP_NAME}\"</span> <span class=\"token string\">\"${MS_HOME}/\"</span> <span class=\"token operator\">\\</span>\n  &amp;&amp; chmod a+x <span class=\"token operator\">\\</span>\n    <span class=\"token string\">\"/usr/local/bin/entrypoint\"</span> <span class=\"token operator\">\\</span>\n    <span class=\"token string\">\"/usr/local/bin/bootstrap\"</span> <span class=\"token operator\">\\</span>\n  &amp;&amp; rm -rf \\    </span>\n    \"/usr/local/lib/node_modules\" \\\n    \"/usr/local/bin/npm\" \\\n    \"/usr/local/bin/docker-entrypoint.sh\"\n<span class=\"token instruction\"><span class=\"token keyword\">USER</span> <span class=\"token string\">\"${USER_NAME}\"</span></span>\n\n\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 8085</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [ <span class=\"token string\">\"/sbin/tini\"</span>, <span class=\"token string\">\"--\"</span>, <span class=\"token string\">\"/usr/local/bin/entrypoint\"</span> ]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Attach-root-user-to-the-executable-file-but-not-writable\" style=\"position:relative;\"><a href=\"#Attach-root-user-to-the-executable-file-but-not-writable\" aria-label=\"Attach root user to the executable file but not writable permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Attach root user to the executable file but not writable</h3>\n<p>It is best practice if you bind all the executables inside a docker file to the root user (make root as the owner of the executables) but it shouldn't be world-writable.</p>\n<p>This technique doesn't let the executing user to modify the binaries or scripts that can cause lots of security issues and open the door for the attackers. This operation effectively enforcecs the container immutability which does not update the code automatically at runtime.In this way, you can prevent your running application from being accidentally or maliciously modified.</p>\n<p>Example</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\">...\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> <span class=\"token variable\">$APP_HOME</span></span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> <span class=\"token options\"><span class=\"token property\">--chown</span><span class=\"token punctuation\">=</span><span class=\"token string\">user:user</span></span> app-files/ /app</span>\n<span class=\"token instruction\"><span class=\"token keyword\">USER</span> app</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> /app/app-entrypoint.sh</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Keep-the-image-as-minimal-as-possible\" style=\"position:relative;\"><a href=\"#Keep-the-image-as-minimal-as-possible\" aria-label=\"Keep the image as minimal as possible permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keep the image as minimal as possible</h3>\n<p>It is a best practice if you avoid adding unnecessary file,, packages, or exposing unecessary ports to reduce the attack surface. As you export your system more you will make the image mainainence harder and you expose your system more particulary the resources and components which are not in your control.</p>\n<h3 id=\"Avoid-confidential-data-leaks\" style=\"position:relative;\"><a href=\"#Avoid-confidential-data-leaks\" aria-label=\"Avoid confidential data leaks permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Avoid confidential data leaks</h3>\n<p>When dealing with containers be careful about your confidential data.</p>\n<p>Never put any credential or secret inside the Dockerfile instructions (Hardcoded inside the Dockerfile). Becareful about the files that get copied inside a docker container. They can be accessible from the previous layer even if you delete them in later instructions inside the Dockerfile. To have access to credentiaal information you can bind them to an external environment variable, then you can fill them using a secure mechanism such as Docker secret or Kubernetes secrets. It is also recommended to use a configuration file and bind moun it in docker or easily mount them from a Kubernetes Configmap or secret.</p>\n<h3 id=\"build-dockerignore-and-context\" style=\"position:relative;\"><a href=\"#build-dockerignore-and-context\" aria-label=\"build dockerignore and context permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>build dockerignore and context</h3>\n<p>Lets take a look at the following instruction to build a docker image</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">docker build -t <span class=\"token punctuation\">{</span>image_name<span class=\"token punctuation\">}</span> <span class=\"token builtin class-name\">.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Using '.' is a suicide. using it as a context is dangerous as you are copying everything including credentials and unnecessary files into the container such as configuration files, credentials, backups, lock files, temporary files, sources, subfolders, dotfiles,etc.</p>\n<p>If we have such an instruction inside our Dockerfile</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . /app</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>this will copy <strong>EVERYTHING</strong> inside the build context including Dockerfile itself also. It is a best practice if create a sub-directory and have anything which is required to be copied to the container in this sub-directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">docker build -t <span class=\"token punctuation\">{</span>image_name<span class=\"token punctuation\">}</span> sub-directory/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>It will be more beautiful if you create a .dockerignore file and explicitly exclude unnecessary files and directories.</p>\n<p>To be continued....</p>\n<p>tell me what else we can apply as best practice?</p>","timeToRead":7,"id":"c246e104-706b-5ac3-94c3-273e2c93dc5e","frontmatter":{"date":"June 24, 2022","title":"How to write a Dockerfile considering best practicecs"}}},"pageContext":{"slug":"/blog/how-to-write-a-dockerfile-considering-best-practicecs"}},"staticQueryHashes":["1033876704","3435786681","550521386"]}