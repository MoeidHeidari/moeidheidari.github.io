{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/from-vo-ip-and-sip-to-web-rtc","result":{"data":{"markdownRemark":{"excerpt":"From VoIP and SIP to WebRTC Author: Moeid Heidari Github: MoeidHeidari (Moeid Heidari) · GitHub Linkedin: https://www.linkedin.com/in…","html":"<h3 id=\"From-VoIP-and-SIP-toWebRTC\" style=\"position:relative;\"><a href=\"#From-VoIP-and-SIP-toWebRTC\" aria-label=\"From VoIP and SIP toWebRTC permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>From VoIP and SIP to WebRTC</h3>\n<p>Author: Moeid Heidari</p>\n<p>Github: <a href=\"https://github.com/MoeidHeidari\">MoeidHeidari (Moeid Heidari) · GitHub</a></p>\n<p>Linkedin: <a href=\"https://www.linkedin.com/in/moeidheidari/\">https://www.linkedin.com/in/moeidheidari/</a></p>\n<p><img src=\"https://cdn-images-1.medium.com/max/880/0*gG2OHJsd5eJ7bpwU.png\"></p>\n<h3 id=\"Introduction-toSIP\" style=\"position:relative;\"><a href=\"#Introduction-toSIP\" aria-label=\"Introduction toSIP permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction to SIP</h3>\n<p>SIP (Session Initiation Protocol) is a signaling protocol established, configures, and terminates the session between two clients on a specific network. SIP has been created to support audio calls, video calls, messaging, presence information, and file transfer between two peers using IP addresses.</p>\n<p>SIP is defined in <code class=\"language-text\">RFC2543</code> standard as a session initiation protocol. It is published by the IEFT (Internet Engineering Task FORCE) in 1999 and developed to resolve the shortcomings of its predecessor H.323 which was limited by a reliance on centralized call routing information servers, and some aspects were not standardized in general. FRC2543 is superseded by newer versions of the protocol but still remains relevant today because it provides a foundation on which other standards are built.</p>\n<h3 id=\"Differences-between-VoIP-andSIP\" style=\"position:relative;\"><a href=\"#Differences-between-VoIP-andSIP\" aria-label=\"Differences between VoIP andSIP permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Differences between VoIP and SIP</h3>\n<p>We refer to the type of call that takes place over the internet as VoIP while SIP is the industry standard protocol that enables VoIP communication between two devices. They can be any device and not just IP phones. We can initiate a call between an intercom device and a mobile application as an instance. VoIP relies on data to transmit voice packets rather than the public switched telephone network (PSTN) while SIP enables text and video so that your communication system can be more dynamic, flexible, and interact with other protocols. Most of the SIP trunking providers would offer VoIP service and unified communication as a service (UCaaS) also.</p>\n<h3 id=\"Pros-and-Cons-of-VoIPOnly\" style=\"position:relative;\"><a href=\"#Pros-and-Cons-of-VoIPOnly\" aria-label=\"Pros and Cons of VoIPOnly permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pros and Cons of VoIP Only</h3>\n<p>Using VoIP alone is something that can be leveraged to great effect by many businesses. It is a low-cost solution that is easy to implement and use without a long-term commitment.</p>\n<p><strong>Pros of VoIP Only</strong></p>\n<p>VoIP can be leveraged on its own as a simple, low-cost solution for voice communication. The main benefits include:</p>\n<ul>\n<li>Low cost to get started with continued savings and flat rate billing.</li>\n<li>VoIP systems do not need an on-site installation and are easy to move.</li>\n<li>Long-term contracts are not required for most VoIP providers.</li>\n</ul>\n<p>Despite its ease of use, there are some limitations to be taken into consideration when using VoIP by itself.</p>\n<p><strong>Cons of VoIP Only</strong></p>\n<p>While using only VoIP certainly has its draws, it is often not a robust enough solution for many businesses. Some things you may want to think about:</p>\n<ul>\n<li>VoIP requires sufficient bandwidth to maintain call quality.</li>\n<li>It lacks support for multimedia communications and is limited to only voice.</li>\n<li>It lacks integration with commonly used third-party applications.</li>\n</ul>\n<h3 id=\"Pros-and-Cons-of-SIP-withVoIP\" style=\"position:relative;\"><a href=\"#Pros-and-Cons-of-SIP-withVoIP\" aria-label=\"Pros and Cons of SIP withVoIP permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pros and Cons of SIP with VoIP</h3>\n<p>While using VoIP alone has definite advantages, it can be enhanced by using SIP. You can increase both scalability and versatility with SIP, adding multimedia communications and more. While there are many reasons to leverage SIP, like using VoIP alone there are also drawbacks.</p>\n<p><strong>Pros of SIP Trunking</strong></p>\n<p>There are many advantages to using SIP for your business. While using VoIP alone has its advantages, the flexibility of SIP makes it a great choice for many companies.</p>\n<ul>\n<li>Very scalable, SIP is not only limited to voice so you can expand into video, messaging, and more.</li>\n<li>Frequently has built-in integration with commonly used software for increased productivity.</li>\n<li>Can be integrated with PRI lines for a combination phone system that best suits your business.</li>\n<li>Very flexible with pricing by allowing for additional features and lines as needed.</li>\n</ul>\n<p><strong>Cons of SIP Trunking</strong></p>\n<p>While the versatility and cost savings of SIP make it a great solution, like using VoIP alone, it is not without its drawbacks.</p>\n<ul>\n<li>Requires sufficient bandwidth to maintain service quality.</li>\n<li>Not all SIP providers offer the same features or quality of service, so you will need to make sure you are choosing the right one for your business.</li>\n<li>SIP can have issues with both quality and security if used on the public internet.</li>\n</ul>\n<h3 id=\"SIP-server\" style=\"position:relative;\"><a href=\"#SIP-server\" aria-label=\"SIP server permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SIP server</h3>\n<p>One of the most prominent parts of a PBX(Private Branch Exchange) system is the SIP server that handles the protocol and all SIP calls routing in the local or public network. SIP servers are designed to make communication possible between two or more endpoints regardless of their location. SIP servers can respond to any create, modify, or terminate telephone call requests from other types of devices on a network. Examples of a SIP server are as follow:</p>\n<ul>\n<li>Call signaling (Dialing)</li>\n<li>Call setup</li>\n<li>Managing user authorization &#x26; authentication</li>\n</ul>\n<p><img src=\"https://cdn-images-1.medium.com/max/880/1*e050MRLn5biEKOhi3CZfZQ.png\"></p>\n<p>Most of the time you would like to set up the SIP server inside the local network of the organization rather than making it publicly accessible. In such a scenario most probably you want to have a call from your client standing outside of the network accordingly. There is an approach for such a purpose which is establishing a SIP proxy server in the organization’s internal network, or it can be hosted by a third-party carrier also. Additionally you can find a cloud-based service that offers <a href=\"https://www.yeastar.com/blog/hosted-phone-system/\">hosted VoIP solutions</a> In general, there are two main types of SIP Proxy Server (SPS)</p>\n<ul>\n<li><strong>Stateless SIP Proxy server</strong></li>\n</ul>\n<p>A proxy that does not save any of the call information. it means there are no records that would typically be kept to troubleshoot and manage the connections. A kind of proxy that just routs the packets.</p>\n<ul>\n<li><strong>Stateful SIP Proxy Server</strong></li>\n</ul>\n<p>A proxy that stores all of the information related to each call or connection. Thus if there are any problems with your connection, you can go through the logs of the call and start troubleshooting. Also, if one SIP user agent drops out, it can re-establish the connection with the other endpoint without having to initiate a new session. This saves bandwidth for both parties as well as time as there are no delays when setting up new connections. <strong>The downside is that stateful SIP proxies have more overhead than stateless ones and are also more expensive because they need more resources to store data.</strong></p>\n<h3 id=\"WebRTC-to-SIP-and-viceversa\" style=\"position:relative;\"><a href=\"#WebRTC-to-SIP-and-viceversa\" aria-label=\"WebRTC to SIP and viceversa permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WebRTC to SIP and vice versa</h3>\n<p><img src=\"https://cdn-images-1.medium.com/max/880/1*5eWND3nfRvGCM03y9MohYQ.png\"></p>\n<p>In this article, we want to go through a solution to make a WebRTC call between a WebRTC client and a legacy SIP client. To do so we need to set up <strong>Kamailio</strong>, <strong>RTPEngine</strong>, and a <strong>TURN</strong> server. The configuration is IPv6 enabled by default and it will bridge SRTP to RTP and ICE to nonICE. You can find a Javascript Webrtc client <a href=\"https://github.com/havfo/SipCaller\">here</a>.</p>\n<p>Regardless of the Linux distribution, we need to install the following tools:</p>\n<ul>\n<li>Kamailio</li>\n<li>RTPEninge</li>\n<li>Nginx (Proxy + WebRTC client)</li>\n<li>Coturn</li>\n</ul>\n<p>Setup Kamailio on Ubuntu 20.04/18.04/16.04</p>\n<ul>\n<li><strong>MariaDB</strong>, The first dependency before installing Kamailio to install is either MariaDB or Mysql. So we need to install one of these databases first.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> mariadb-server</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><strong>Kamailio repository</strong>, With the following command you can</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">wget</span> -O- http://deb.kamailio.org/kamailiodebkey.gpg <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Then add the repository lines to your <code class=\"language-text\">/etc/apt/sources.list</code> file depending on the Kamailio version of your choice</p>\n<p><strong>For Ubuntu 20.04</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/kamailio.list<span class=\"token operator\">&lt;&lt;</span>EOFdeb http://deb.kamailio.org/kamailio55 focal maindeb-src http://deb.kamailio.org/kamailio55 focal mainEOF</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><strong>For Ubuntu 18.04</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/kamailio.list<span class=\"token operator\">&lt;&lt;</span>EOFdeb http://deb.kamailio.org/kamailio55 bionic maindeb-src http://deb.kamailio.org/kamailio55 bionic mainEOF</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><strong>For Ubuntu 16.04</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/kamailio.list<span class=\"token operator\">&lt;&lt;</span>EOFdeb http://deb.kamailio.org/kamailio55 xenial maindeb-src http://deb.kamailio.org/kamailio55 xenial mainEOF</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li>Install <strong>Kamailio</strong> on Ubuntu 20.04|18.04|16.04</li>\n</ul>\n<p>Once the repository has been configured, update your system and install Kamailio. You’ll also install Kamailio MySQL modules:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo apt updatesudo apt install kamailio kamailio-mysql-modules</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>sudo apt install kamailio-websocket-modules kamailio-tls-modules</p>\n<h3 id=\"Configure-Kamailio-on-Ubuntu-200418041604\" style=\"position:relative;\"><a href=\"#Configure-Kamailio-on-Ubuntu-200418041604\" aria-label=\"Configure Kamailio on Ubuntu 200418041604 permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure Kamailio on Ubuntu 20.04|18.04|16.04</h3>\n<p>Edit the file <code class=\"language-text\">/etc/kamailio/kamctlrc</code> and make sure the <code class=\"language-text\">DBENGINE</code> variable is set to MySQL. Remove the <code class=\"language-text\">#</code> symbol to uncomment it.</p>\n<p>Set Database engine to MYSQL</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ sudo vim /etc/kamailio/kamctlrcDBENGINE=MYSQLDBHOST=localhost</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Next is to create a database for Mysql. The command below will create users and tables needed by Kamailio( Schema)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ sudo kamdbctl createMySQL password for root: INFO: creating database kamailio ...INFO: granting privileges to database kamailio ...INFO: creating standard tables into kamailio ...INFO: Core Kamailio tables succesfully created.Install presence related tables? (y/n): yINFO: creating presence tables into kamailio ...INFO: Presence tables succesfully created.Install tables for imc cpl siptrace domainpolicy carrierroutedrouting userblacklist htable purple uac pipelimit mtree sca mohqueuertpproxy rtpengine? (y/n): yINFO: creating extra tables into kamailio ...INFO: Extra tables succesfully created.Install tables for uid_auth_db uid_avp_db uid_domain uid_gflagsuid_uri_db? (y/n): yINFO: creating uid tables into kamailio ...INFO: UID tables succesfully created.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>You will be prompted to provide a MySQL root password. Mysql <strong>users</strong> and passwords added by the above command are.</p>\n<ul>\n<li><strong>kamailio</strong> with the password <code class=\"language-text\">kamailiorw</code>. It has read/write access permissions to the Kamailio database.</li>\n<li><strong>kamailioro</strong>: The password for this user is <code class=\"language-text\">kamailioro</code>. It has read-only access permissions to the Kamailio database.</li>\n</ul>\n<p>The <code class=\"language-text\">/etc/kamailio/kamailio.cfg</code> is the configuration file for Kamailio. Edit it to enable some of the features shipped with it.</p>\n<p>You can also set your SIP domain:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ sudo vim /etc/kamailio/kamctlrc## your SIP domainSIP_DOMAIN=computingforgeeks.com</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If you don't have a working DNS server on your local network, you can as well use <strong>an IP Address</strong> in place of a domain name.</p>\n<p>Add the following lines just below <strong>#!KAMAILIO.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">$ sudo vim /etc/kamailio/kamailio.cfg#!define WITH_MYSQL#!define WITH_AUTH#!define WITH_USRLOCDB#!define WITH_ACCDB</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>These directives will turn on necessary modules. E.g when you specify,<code class=\"language-text\">WITH_MYSQL</code> it enables the loading of mysql.so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">#!ifdef WITH_MYSQLloadmodule \"db_mysql.so\"#!endif</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Then restart the Kamailio service:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">sudo systemctl restart kamailio</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>If you encounter any issues with Kamailio service, the logs are available on: <code class=\"language-text\">/var/log/kamailio.log</code></p>\n<h3 id=\"Certificates\" style=\"position:relative;\"><a href=\"#Certificates\" aria-label=\"Certificates permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Certificates</h3>\n<p>The next step is to make the Certificates. To do so we can use a solution like Let’s Encrypt. Then we can use the same certificate for Kamailio TLS, Nginx TLS, and TURN TLS.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> certbot\n\ncertbot certonly --standalone -d YOUR-DOMAIN</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>You will then find the certificates under:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">/etc/letsencrypt/live/YOUR-DOMAIN/privkey.pem\n\n/etc/letsencrypt/live/YOUR-DOMAIN/fullchain.pem</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Get-configuration-files\" style=\"position:relative;\"><a href=\"#Get-configuration-files\" aria-label=\"Get configuration files permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get configuration files</h3>\n<p>All files needed to setup all components on Debian 9 Stretch.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone <span class=\"token punctuation\">[</span>GitHub - havfo/WEBRTC-to-SIP: Setup <span class=\"token keyword\">for</span> a WEBRTC client and Kamailio server to call SIP clients<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>https://github.com/havfo/WEBRTC-to-SIP.git<span class=\"token punctuation\">)</span>\n\n<span class=\"token builtin class-name\">cd</span> WEBRTC-to-SIP\n\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> -type f -print0 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -0 <span class=\"token function\">sed</span> -i <span class=\"token string\">'s/XXXXXX-XXXXXX/PUT-IPV6-OF-YOUR-SIP-SERVER-HERE/g'</span>\n\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> -type f -print0 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -0 <span class=\"token function\">sed</span> -i <span class=\"token string\">'s/XXXXX-XXXXX/PUT-IPV4-OF-YOUR-SIP-SERVER-HERE/g'</span>\n\n<span class=\"token function\">find</span> <span class=\"token builtin class-name\">.</span> -type f -print0 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -0 <span class=\"token function\">sed</span> -i <span class=\"token string\">'s/XXXX-XXXX/PUT-DOMAIN-OF-YOUR-SIP-SERVER-HERE/g'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Install-RTPEngine\" style=\"position:relative;\"><a href=\"#Install-RTPEngine\" aria-label=\"Install RTPEngine permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install RTPEngine</h3>\n<p>This will do the SRTP-RTP bridging needed to make WebRTC clients talk to legacy SIP servers/clients. You can find the latest build instructions in their <a href=\"https://github.com/sipwise/rtpengine#on-a-debian-system\">readme</a>.</p>\n<p>The easiest way of installing is to get it from the Sipwise repository:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'deb [Index of /spce/mr9.4.1](https://deb.sipwise.com/spce/mr9.4.1/) buster main'</span> <span class=\"token operator\">></span> /etc/apt/sources.list.d/sipwise.list\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'deb-src [Index of /spce/mr9.4.1](https://deb.sipwise.com/spce/mr9.4.1/) buster main'</span> <span class=\"token operator\">>></span> /etc/apt/sources.list.d/sipwise.list\n\n<span class=\"token function\">wget</span> -q -O - https://deb.sipwise.com/spce/keyring/sipwise-keyring-bootstrap.gpg <span class=\"token operator\">|</span> apt-key <span class=\"token function\">add</span> -\n\n<span class=\"token function\">apt-get</span> update\n\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y ngcp-keyring ngcp-rtpengine</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>After you have successfully installed RTPEngine, copy the configuration from this repository.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> WEBRTC-to-SIP\n\n<span class=\"token function\">cp</span> etc/default/ngcp-rtpengine-daemon /etc/default/\n\n<span class=\"token function\">cp</span> etc/rtpengine/rtpengine.conf /etc/rtpengine/\n\n/etc/init.d/ngcp-rtpengine-daemon restart</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Install-IPTables-firewall-optional\" style=\"position:relative;\"><a href=\"#Install-IPTables-firewall-optional\" aria-label=\"Install IPTables firewall optional permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install IPTables firewall (optional)</h3>\n<p>RTPEngine handles the chain for itself, but makes sure to not block the RTP ports it is using. Take a look in iptables.sh for details, and apply it by doing the following. This will persist after the reboot. You can run the iptables.sh script at any time after it is set up.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> WEBRTC-to-SIP\n\n<span class=\"token function\">chmod</span> +x iptables.sh\n\n<span class=\"token function\">cp</span> etc/network/if-up.d/iptables /etc/network/if-up.d/\n\n<span class=\"token function\">chmod</span> +x /etc/network/if-up.d/iptables\n\n<span class=\"token function\">touch</span> /etc/iptables/firewall.conf\n\n<span class=\"token function\">touch</span> /etc/iptables/firewall6.conf\n\n./iptables.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Install-WebRTCclient\" style=\"position:relative;\"><a href=\"#Install-WebRTCclient\" aria-label=\"Install WebRTCclient permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install WebRTC client</h3>\n<p>This will install the client that can be found <a href=\"https://github.com/havfo/SipCaller\">here</a>.</p>\n<p>To be able to support running HTTP(S) and TURN on the same port (443), we need a newer version of Nginx that supports streams the way we need. Get it from the official repo:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'deb [Index of /packages/mainline/debian/](http://nginx.org/packages/mainline/debian/) buster nginx'</span> <span class=\"token operator\">></span> /etc/apt/sources.list.d/nginx.list\n\n<span class=\"token function\">curl</span> -fsSL https://nginx.org/keys/nginx_signing.key <span class=\"token operator\">|</span> apt-key <span class=\"token function\">add</span> -\n\n<span class=\"token function\">apt-get</span> update\n\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> nginx\n\n<span class=\"token builtin class-name\">cd</span> WEBRTC-to-SIP\n\n<span class=\"token function\">cp</span> etc/nginx/nginx.conf /etc/nginx/\n\n<span class=\"token function\">cp</span> etc/nginx/conf.d/default.conf /etc/nginx/conf.d/\n\n<span class=\"token function\">cp</span> -r client/* /var/www/html/\n\n<span class=\"token function\">service</span> nginx restart</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"Install-TURNserver\" style=\"position:relative;\"><a href=\"#Install-TURNserver\" aria-label=\"Install TURNserver permalink\" class=\"gatsby-remark-autolink before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install TURN server</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> coturn\n\n<span class=\"token function\">cp</span> etc/default/coturn /etc/default/\n\n<span class=\"token function\">cp</span> etc/turnserver.conf /etc/\n\n<span class=\"token function\">service</span> coturn restart</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You should now be able to go to <a href=\"https://xxxx-xxxx/\">https://XXXX-XXXX/</a> and call legacy SIP clients. Click the account icon in the top right corner and add the following settings:</p>\n<ul>\n<li>Display name: Whatever</li>\n<li>SIP URI: websip@XXXX-XXXX</li>\n<li>Password: websip</li>\n<li>Outbound Proxy: wss://XXXX-XXXX/ws</li>\n</ul>\n<p>To manually configure other TURN servers, change the config in <code class=\"language-text\">client/config.js</code>.</p>","timeToRead":11,"id":"43f040eb-764a-53a8-a6c0-17234a2731cf","frontmatter":{"date":"April 23, 2022","title":"From VoIP and SIP to WebRTC"}}},"pageContext":{"slug":"/blog/from-vo-ip-and-sip-to-web-rtc"}},"staticQueryHashes":["1033876704","3435786681","550521386"]}